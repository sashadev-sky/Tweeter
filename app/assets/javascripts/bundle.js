!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([function(e,t){const s={followUser:e=>s.changeFollowStatus(e,"POST"),unfollowUser:e=>s.changeFollowStatus(e,"DELETE"),changeFollowStatus:(e,t)=>$.ajax({url:`/users/${e}/follow`,dataType:"json",method:`${t}`}),searchUsers:e=>$.ajax({url:"/users/search",dataType:"json",method:"GET",data:{query:e}}),createTweet:e=>$.ajax({url:"/tweets",method:"POST",dataType:"json",data:e}),fetchTweets:e=>$.ajax({url:"/feed",method:"GET",dataType:"json",data:e})};e.exports=s},function(e,t,s){const n=s(0);e.exports=class{constructor(e,t){this.$el=$(e),this.userId=this.$el.data("user-id")||t.userId,this.followState=this.$el.data("initial-follow-state")||t.followState,this.render(),this.$el.on("click",this.handleClick.bind(this))}handleClick(e){e.preventDefault(),"this is you!"===this.followState||current_user===this.userId?this.render():"followed"===this.followState?(this.followState="unfollowing",this.render(),n.unfollowUser(this.userId).then(()=>{this.followState="unfollowed",this.render()})):"unfollowed"===this.followState&&(this.followState="following",this.render(),n.followUser(this.userId).then(()=>{this.followState="followed",this.render()}))}render(){switch(this.followState){case"followed":this.$el.prop("disabled",!1),this.$el.html("Unfollow!");break;case"unfollowed":this.$el.prop("disabled",!1),this.$el.html("Follow!");break;case"following":this.$el.prop("disabled",!0),this.$el.html("Following...");break;case"unfollowing":this.$el.prop("disabled",!0),this.$el.html("Unfollowing...");break;case"this is you!":this.$el.prop("disabled",!0),this.$el.addClass("user-self"),this.$el.html("this is you!")}}}},function(e,t,s){const n=s(1),i=s(3),l=s(4),o=s(5);$(function(){$("div.infinite-tweets").each((e,t)=>new o(t)),$("button.follow-toggle").each((e,t)=>new n(t,{})),$(".users-search").each((e,t)=>new i(t)),$("form.tweet-compose").each((e,t)=>new l(t))})},function(e,t,s){const n=s(0),i=s(1);e.exports=class{constructor(e){this.$el=$(e),this.$input=this.$el.find("input[name=username]"),this.$ul=this.$el.find(".users"),this.$input.on("input",this.handleInput.bind(this))}handleInput(e){""!==this.$input.val()?n.searchUsers(this.$input.val()).then(e=>this.renderResults(e)):this.renderResults([])}renderResults(e){this.$ul.empty();for(let t=0;t<e.length;t++){const s=e[t];let n=$("<a></a>");n.text(`@${s.username}`),n.attr("href",`/users/${s.id}`);const l=$("<button></button>");s.id!==current_user?new i(l,{userId:s.id,followState:s.followed?"followed":"unfollowed"}):new i(l,{userId:s.id,followState:"this is you!"});const o=$("<li></li>");o.append(n),o.append(l),this.$ul.append(o)}}}},function(e,t,s){const n=s(0);e.exports=class{constructor(e){this.$el=$(e),this.$input=this.$el.find("textarea[name=tweet\\[content\\]]"),this.$input.on("input",this.handleInput.bind(this)),this.$mentionedUsersDiv=this.$el.find(".mentioned-users"),this.$el.find(".add-mentioned-user").on("click",this.addMentionedUser.bind(this)),this.$mentionedUsersDiv.on("click",".remove-mentioned-user",this.removeMentionedUser.bind(this)),this.$el.on("submit",this.submit.bind(this))}addMentionedUser(e){e.preventDefault(),this.$mentionedUsersDiv.append(this.newUserSelect())}clearInput(){this.$input.val(""),this.$mentionedUsersDiv.find("div").empty(),this.$el.find(":input").prop("disabled",!1),this.$el.find(".char-left").empty()}handleInput(e){const t=this.$input.val().length;this.$el.find(".char-left").text(`${140-t} characters left`)}handleSuccess(e){$(this.$el.data("tweets-ul")).trigger("insert-tweet",e),this.clearInput()}newUserSelect(){const e=`\n      <div>\n        <select name='tweet[mentioned_user_ids][]'>\n          ${window.users.map(e=>`<option value='${e.id}'>${e.username}</option>`).join("")}\n        </select>\n        <button class='remove-mentioned-user'>Remove</button>\n      </div>`;return $(e)}removeMentionedUser(e){e.preventDefault(),$(e.currentTarget).parent().remove()}submit(e){e.preventDefault();const t=this.$el.serializeJSON();this.$el.find(":input").prop("disabled",!0),n.createTweet(t).then(e=>this.handleSuccess(e))}}},function(e,t,s){const n=s(0);e.exports=class{constructor(e){this.$el=$(e),this.lastCreatedAt=null,this.$el.on("click",".fetch-more",this.fetchTweets.bind(this)),this.$el.on("insert-tweet",this.insertTweet.bind(this))}insertTweet(e,t){this.$el.find("ul.tweets").prepend(this.tweetElement(t)),this.lastCreatedAt||(this.lastCreatedAt=t.created_at)}insertTweets(e){this.$el.find("ul.tweets").append(e.map(this.tweetElement))}fetchTweets(e){e.preventDefault();const t=this,s={};this.lastCreatedAt&&(s.max_created_at=this.lastCreatedAt),n.fetchTweets(s).then(e=>{t.insertTweets(e),e.length<20&&t.$el.find(".fetch-more").replaceWith("<b>No more tweets!</b>"),e.length>0&&(t.lastCreatedAt=e[e.length-1].created_at)})}tweetElement(e){const t=e.mentions.map(e=>`<li class='tweetee'>\n        <a href='/users/${e.user.id}'>@${e.user.username}</a>\n      </li>`).join(""),s=`\n    <div class='tweet'>\n      <h3 class='tweeter'>\n        <a href='/users/${e.user.id}'>\n          @${e.user.username}\n        </a>\n      </h3>\n      \n      <p>${e.content}</p>\n      \n      <ul>Mentions\n        ${t}\n      </ul>\n    </div>`;return $(s)}}}]);
//# sourceMappingURL=bundle.js.map